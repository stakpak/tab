{
  "version": 3,
  "sources": ["../src/popup/index.ts"],
  "sourcesContent": ["/**\n * Popup UI Logic\n * Handles communication with background service worker and UI updates\n */\n\nimport type {\n  PopupMessage,\n  StatusResponse,\n  SessionIdResponse,\n  ActivityLogEntry,\n  ConnectionStatus,\n} from '../shared/messages';\n\n// =============================================================================\n// DOM ELEMENTS\n// =============================================================================\n\nconst elements = {\n  statusBadge: document.getElementById('status-badge') as HTMLDivElement,\n  statusText: document.getElementById('status-text') as HTMLSpanElement,\n  sessionId: document.getElementById('session-id') as HTMLElement,\n  copySessionBtn: document.getElementById('copy-session-btn') as HTMLButtonElement,\n  wsUrlInput: document.getElementById('ws-url') as HTMLInputElement,\n  saveUrlBtn: document.getElementById('save-url-btn') as HTMLButtonElement,\n  connectBtn: document.getElementById('connect-btn') as HTMLButtonElement,\n  disconnectBtn: document.getElementById('disconnect-btn') as HTMLButtonElement,\n  reconnectHint: document.getElementById('reconnect-hint') as HTMLParagraphElement,\n  activityLog: document.getElementById('activity-log') as HTMLDivElement,\n  clearLogBtn: document.getElementById('clear-log-btn') as HTMLButtonElement,\n};\n\n// =============================================================================\n// STATE\n// =============================================================================\n\nlet currentStatus: ConnectionStatus = 'DISCONNECTED';\nlet currentSessionId: string | null = null;\nlet activityEntries: ActivityLogEntry[] = [];\n\n// =============================================================================\n// MESSAGE SENDING\n// =============================================================================\n\nasync function sendMessage<T>(message: PopupMessage): Promise<T> {\n  return new Promise((resolve, reject) => {\n    chrome.runtime.sendMessage(message, (response) => {\n      if (chrome.runtime.lastError) {\n        reject(new Error(chrome.runtime.lastError.message));\n      } else {\n        resolve(response as T);\n      }\n    });\n  });\n}\n\n// =============================================================================\n// UI UPDATE FUNCTIONS\n// =============================================================================\n\nfunction updateConnectionStatus(status: ConnectionStatus): void {\n  currentStatus = status;\n\n  // Update badge class\n  elements.statusBadge.className = 'status-badge ' + status.toLowerCase();\n\n  // Update text\n  const statusLabels: Record<ConnectionStatus, string> = {\n    CONNECTED: 'Connected',\n    CONNECTING: 'Connecting...',\n    DISCONNECTED: 'Disconnected',\n  };\n  elements.statusText.textContent = statusLabels[status];\n\n  // Update button states\n  elements.connectBtn.disabled = status === 'CONNECTED' || status === 'CONNECTING';\n  elements.disconnectBtn.disabled = status === 'DISCONNECTED';\n  elements.wsUrlInput.disabled = status === 'CONNECTED' || status === 'CONNECTING';\n  elements.saveUrlBtn.disabled = status === 'CONNECTED' || status === 'CONNECTING';\n}\n\nfunction updateReconnectHint(attempts: number, maxAttempts: number): void {\n  if (currentStatus === 'DISCONNECTED' && attempts > 0) {\n    elements.reconnectHint.textContent = `Reconnect attempts: ${attempts}/${maxAttempts}`;\n  } else {\n    elements.reconnectHint.textContent = '';\n  }\n}\n\nfunction updateSessionId(sessionId: string | null): void {\n  currentSessionId = sessionId;\n  if (sessionId) {\n    elements.sessionId.textContent = sessionId;\n    elements.sessionId.classList.remove('not-connected');\n    elements.copySessionBtn.disabled = false;\n  } else {\n    elements.sessionId.textContent = 'Not connected';\n    elements.sessionId.classList.add('not-connected');\n    elements.copySessionBtn.disabled = true;\n  }\n}\n\nasync function handleCopySessionId(): Promise<void> {\n  if (!currentSessionId) return;\n  try {\n    await navigator.clipboard.writeText(currentSessionId);\n    const originalText = elements.copySessionBtn.textContent;\n    elements.copySessionBtn.textContent = 'Copied!';\n    setTimeout(() => {\n      elements.copySessionBtn.textContent = originalText;\n    }, 1500);\n  } catch (error) {\n    console.error('Failed to copy:', error);\n  }\n}\n\nfunction renderActivityLog(): void {\n  if (activityEntries.length === 0) {\n    elements.activityLog.innerHTML = '<p class=\"log-empty\">No activity yet</p>';\n    return;\n  }\n\n  // Show most recent entries first, limit to 50\n  const entries = activityEntries.slice(-50).reverse();\n\n  elements.activityLog.innerHTML = entries\n    .map((entry) => {\n      const time = new Date(entry.timestamp).toLocaleTimeString('en-US', {\n        hour12: false,\n        hour: '2-digit',\n        minute: '2-digit',\n        second: '2-digit',\n      });\n\n      const icons: Record<string, string> = {\n        command: '\\u2192',   // \u2192\n        response: '\\u2190',  // \u2190\n        connection: '\\u26A1', // \u26A1\n        error: '\\u2716',     // \u2716\n      };\n\n      return `\n        <div class=\"log-entry ${entry.type}\">\n          <span class=\"log-time\">${time}</span>\n          <span class=\"log-icon\">${icons[entry.type] || '\\u2022'}</span>\n          <span class=\"log-message\">${escapeHtml(entry.summary)}</span>\n        </div>\n      `;\n    })\n    .join('');\n}\n\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nfunction addLocalLogEntry(type: ActivityLogEntry['type'], summary: string): void {\n  activityEntries.push({\n    id: crypto.randomUUID(),\n    timestamp: Date.now(),\n    type,\n    summary,\n  });\n  renderActivityLog();\n}\n\n// =============================================================================\n// EVENT HANDLERS\n// =============================================================================\n\nasync function handleConnect(): Promise<void> {\n  try {\n    updateConnectionStatus('CONNECTING');\n    await sendMessage({ type: 'CONNECT' });\n    addLocalLogEntry('connection', 'Connection initiated');\n  } catch (error) {\n    console.error('Connect error:', error);\n    addLocalLogEntry('error', `Failed to connect: ${error}`);\n    updateConnectionStatus('DISCONNECTED');\n  }\n}\n\nasync function handleDisconnect(): Promise<void> {\n  try {\n    await sendMessage({ type: 'DISCONNECT' });\n    updateConnectionStatus('DISCONNECTED');\n    addLocalLogEntry('connection', 'Disconnected');\n  } catch (error) {\n    console.error('Disconnect error:', error);\n    addLocalLogEntry('error', `Disconnect error: ${error}`);\n  }\n}\n\nasync function handleSaveUrl(): Promise<void> {\n  const url = elements.wsUrlInput.value.trim();\n  if (!url) {\n    return;\n  }\n\n  // Basic URL validation\n  if (!url.startsWith('ws://') && !url.startsWith('wss://')) {\n    addLocalLogEntry('error', 'Invalid URL: must start with ws:// or wss://');\n    return;\n  }\n\n  try {\n    await sendMessage({ type: 'UPDATE_URL', payload: { url } });\n    addLocalLogEntry('connection', `Server URL updated: ${url}`);\n  } catch (error) {\n    console.error('Save URL error:', error);\n    addLocalLogEntry('error', `Failed to save URL: ${error}`);\n  }\n}\n\nfunction handleClearLog(): void {\n  activityEntries = [];\n  renderActivityLog();\n}\n\n// =============================================================================\n// INITIALIZATION\n// =============================================================================\n\nasync function loadStatus(): Promise<void> {\n  try {\n    const status = await sendMessage<StatusResponse>({ type: 'GET_STATUS' });\n    updateConnectionStatus(status.connectionStatus);\n    elements.wsUrlInput.value = status.websocketUrl;\n    updateReconnectHint(status.reconnectAttempts, status.maxReconnectAttempts);\n  } catch (error) {\n    console.error('Failed to load status:', error);\n    addLocalLogEntry('error', 'Failed to load status from background');\n  }\n}\n\nasync function loadSessionId(): Promise<void> {\n  try {\n    // Get current window ID first (popup runs in context of its window)\n    const currentWindow = await chrome.windows.getCurrent();\n    if (!currentWindow.id) {\n      updateSessionId(null);\n      return;\n    }\n    const response = await sendMessage<SessionIdResponse>({ \n      type: 'GET_SESSION_ID',\n      payload: { windowId: currentWindow.id }\n    });\n    updateSessionId(response.sessionId);\n  } catch (error) {\n    console.error('Failed to load session ID:', error);\n    updateSessionId(null);\n  }\n}\n\nasync function loadActivityLog(): Promise<void> {\n  try {\n    const response = await sendMessage<{ entries: ActivityLogEntry[] }>({\n      type: 'GET_ACTIVITY_LOG',\n    });\n    activityEntries = response.entries || [];\n    renderActivityLog();\n  } catch (error) {\n    console.error('Failed to load activity log:', error);\n  }\n}\n\nfunction setupEventListeners(): void {\n  elements.connectBtn.addEventListener('click', handleConnect);\n  elements.disconnectBtn.addEventListener('click', handleDisconnect);\n  elements.saveUrlBtn.addEventListener('click', handleSaveUrl);\n  elements.clearLogBtn.addEventListener('click', handleClearLog);\n  elements.copySessionBtn.addEventListener('click', handleCopySessionId);\n\n  // Enter key in URL input triggers save\n  elements.wsUrlInput.addEventListener('keydown', (e) => {\n    if (e.key === 'Enter') {\n      handleSaveUrl();\n    }\n  });\n}\n\n// Listen for status updates from background\nchrome.runtime.onMessage.addListener((message) => {\n  if (message.type === 'STATUS_UPDATE') {\n    updateConnectionStatus(message.status);\n    if (message.reconnectAttempts !== undefined) {\n      updateReconnectHint(message.reconnectAttempts, message.maxReconnectAttempts);\n    }\n    // Refresh session ID when status changes\n    loadSessionId();\n  } else if (message.type === 'ACTIVITY_LOG_ENTRY') {\n    activityEntries.push(message.entry);\n    renderActivityLog();\n  }\n});\n\n// Initialize\ndocument.addEventListener('DOMContentLoaded', async () => {\n  setupEventListeners();\n  await loadStatus();\n  await loadSessionId();\n  await loadActivityLog();\n});\n"],
  "mappings": "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",
  "names": []
}
